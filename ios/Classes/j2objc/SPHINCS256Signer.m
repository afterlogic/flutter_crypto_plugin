//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ../android/src/main/kotlin/lib/org/bouncycastle/pqc/crypto/sphincs/SPHINCS256Signer.java
//

#include "CipherParameters.h"
#include "Digest.h"
#include "HashFunctions.h"
#include "Horst.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "Pack.h"
#include "ParametersWithRandom.h"
#include "SPHINCS256Config.h"
#include "SPHINCS256Signer.h"
#include "SPHINCSPrivateKeyParameters.h"
#include "SPHINCSPublicKeyParameters.h"
#include "Seed.h"
#include "Tree.h"
#include "Wots.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/System.h"

@interface LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer () {
 @public
  LibOrgBouncycastlePqcCryptoSphincsHashFunctions *hashFunctions_;
  IOSByteArray *keyData_;
}

- (void)zerobytesWithByteArray:(IOSByteArray *)tsk
                       withInt:(jint)off
                       withInt:(jint)cryptoSecretkeybytes;

@end

J2OBJC_FIELD_SETTER(LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer, hashFunctions_, LibOrgBouncycastlePqcCryptoSphincsHashFunctions *)
J2OBJC_FIELD_SETTER(LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer, keyData_, IOSByteArray *)

__attribute__((unused)) static void LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer_zerobytesWithByteArray_withInt_withInt_(LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer *self, IOSByteArray *tsk, jint off, jint cryptoSecretkeybytes);

@implementation LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer

- (instancetype)initWithLibOrgBouncycastleCryptoDigest:(id<LibOrgBouncycastleCryptoDigest>)nDigest
                    withLibOrgBouncycastleCryptoDigest:(id<LibOrgBouncycastleCryptoDigest>)twoNDigest {
  LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer_initWithLibOrgBouncycastleCryptoDigest_withLibOrgBouncycastleCryptoDigest_(self, nDigest, twoNDigest);
  return self;
}

- (void)init__WithBoolean:(jboolean)forSigning
withLibOrgBouncycastleCryptoCipherParameters:(id<LibOrgBouncycastleCryptoCipherParameters>)param {
  if (forSigning) {
    if ([param isKindOfClass:[LibOrgBouncycastleCryptoParamsParametersWithRandom class]]) {
      keyData_ = [((LibOrgBouncycastlePqcCryptoSphincsSPHINCSPrivateKeyParameters *) nil_chk(((LibOrgBouncycastlePqcCryptoSphincsSPHINCSPrivateKeyParameters *) cast_chk([((LibOrgBouncycastleCryptoParamsParametersWithRandom *) nil_chk(((LibOrgBouncycastleCryptoParamsParametersWithRandom *) param))) getParameters], [LibOrgBouncycastlePqcCryptoSphincsSPHINCSPrivateKeyParameters class])))) getKeyData];
    }
    else {
      keyData_ = [((LibOrgBouncycastlePqcCryptoSphincsSPHINCSPrivateKeyParameters *) nil_chk(((LibOrgBouncycastlePqcCryptoSphincsSPHINCSPrivateKeyParameters *) cast_chk(param, [LibOrgBouncycastlePqcCryptoSphincsSPHINCSPrivateKeyParameters class])))) getKeyData];
    }
  }
  else {
    keyData_ = [((LibOrgBouncycastlePqcCryptoSphincsSPHINCSPublicKeyParameters *) nil_chk(((LibOrgBouncycastlePqcCryptoSphincsSPHINCSPublicKeyParameters *) cast_chk(param, [LibOrgBouncycastlePqcCryptoSphincsSPHINCSPublicKeyParameters class])))) getKeyData];
  }
}

- (IOSByteArray *)generateSignatureWithByteArray:(IOSByteArray *)message {
  return [self crypto_signWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions:hashFunctions_ withByteArray:message withByteArray:keyData_];
}

- (jboolean)verifySignatureWithByteArray:(IOSByteArray *)message
                           withByteArray:(IOSByteArray *)signature {
  return [self verifyWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions:hashFunctions_ withByteArray:message withByteArray:signature withByteArray:keyData_];
}

+ (void)validate_authpathWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions:(LibOrgBouncycastlePqcCryptoSphincsHashFunctions *)hs
                                                               withByteArray:(IOSByteArray *)root
                                                               withByteArray:(IOSByteArray *)leaf
                                                                     withInt:(jint)leafidx
                                                               withByteArray:(IOSByteArray *)authpath
                                                                     withInt:(jint)auOff
                                                               withByteArray:(IOSByteArray *)masks
                                                                     withInt:(jint)height {
  LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer_validate_authpathWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions_withByteArray_withByteArray_withInt_withByteArray_withInt_withByteArray_withInt_(hs, root, leaf, leafidx, authpath, auOff, masks, height);
}

+ (void)compute_authpath_wotsWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions:(LibOrgBouncycastlePqcCryptoSphincsHashFunctions *)hs
                                                                   withByteArray:(IOSByteArray *)root
                                                                   withByteArray:(IOSByteArray *)authpath
                                                                         withInt:(jint)authOff
                             withLibOrgBouncycastlePqcCryptoSphincsTree_leafaddr:(LibOrgBouncycastlePqcCryptoSphincsTree_leafaddr *)a
                                                                   withByteArray:(IOSByteArray *)sk
                                                                   withByteArray:(IOSByteArray *)masks
                                                                         withInt:(jint)height {
  LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer_compute_authpath_wotsWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions_withByteArray_withByteArray_withInt_withLibOrgBouncycastlePqcCryptoSphincsTree_leafaddr_withByteArray_withByteArray_withInt_(hs, root, authpath, authOff, a, sk, masks, height);
}

- (IOSByteArray *)crypto_signWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions:(LibOrgBouncycastlePqcCryptoSphincsHashFunctions *)hs
                                                                   withByteArray:(IOSByteArray *)m
                                                                   withByteArray:(IOSByteArray *)sk {
  IOSByteArray *sm = [IOSByteArray newArrayWithLength:LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_CRYPTO_BYTES];
  jint i;
  jlong leafidx;
  IOSByteArray *R = [IOSByteArray newArrayWithLength:LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_MESSAGE_HASH_SEED_BYTES];
  IOSByteArray *m_h = [IOSByteArray newArrayWithLength:LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_MSGHASH_BYTES];
  IOSLongArray *rnd = [IOSLongArray newArrayWithLength:8];
  IOSByteArray *root = [IOSByteArray newArrayWithLength:LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES];
  IOSByteArray *seed = [IOSByteArray newArrayWithLength:LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SEED_BYTES];
  IOSByteArray *masks = [IOSByteArray newArrayWithLength:LibOrgBouncycastlePqcCryptoSphincsHorst_N_MASKS * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES];
  jint pk;
  IOSByteArray *tsk = [IOSByteArray newArrayWithLength:LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_CRYPTO_SECRETKEYBYTES];
  for (i = 0; i < LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_CRYPTO_SECRETKEYBYTES; i++) {
    *IOSByteArray_GetRef(tsk, i) = IOSByteArray_Get(nil_chk(sk), i);
  }
  {
    jint scratch = LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_CRYPTO_BYTES - LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SK_RAND_SEED_BYTES;
    JavaLangSystem_arraycopyWithId_withInt_withId_withInt_withInt_(tsk, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_CRYPTO_SECRETKEYBYTES - LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SK_RAND_SEED_BYTES, sm, scratch, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SK_RAND_SEED_BYTES);
    id<LibOrgBouncycastleCryptoDigest> d = [((LibOrgBouncycastlePqcCryptoSphincsHashFunctions *) nil_chk(hs)) getMessageHash];
    IOSByteArray *bRnd = [IOSByteArray newArrayWithLength:[((id<LibOrgBouncycastleCryptoDigest>) nil_chk(d)) getDigestSize]];
    [d updateWithByteArray:sm withInt:scratch withInt:LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SK_RAND_SEED_BYTES];
    [d updateWithByteArray:m withInt:0 withInt:((IOSByteArray *) nil_chk(m))->size_];
    [d doFinalWithByteArray:bRnd withInt:0];
    LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer_zerobytesWithByteArray_withInt_withInt_(self, sm, scratch, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SK_RAND_SEED_BYTES);
    for (jint j = 0; j != rnd->size_; j++) {
      *IOSLongArray_GetRef(rnd, j) = LibOrgBouncycastleUtilPack_littleEndianToLongWithByteArray_withInt_(bRnd, j * 8);
    }
    leafidx = IOSLongArray_Get(rnd, 0) & (jlong) 0xfffffffffffffffLL;
    JavaLangSystem_arraycopyWithId_withInt_withId_withInt_withInt_(bRnd, 16, R, 0, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_MESSAGE_HASH_SEED_BYTES);
    scratch = LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_CRYPTO_BYTES - LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_MESSAGE_HASH_SEED_BYTES - LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_CRYPTO_PUBLICKEYBYTES;
    JavaLangSystem_arraycopyWithId_withInt_withId_withInt_withInt_(R, 0, sm, scratch, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_MESSAGE_HASH_SEED_BYTES);
    LibOrgBouncycastlePqcCryptoSphincsTree_leafaddr *b = new_LibOrgBouncycastlePqcCryptoSphincsTree_leafaddr_init();
    b->level_ = LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_N_LEVELS - 1;
    b->subtree_ = 0;
    b->subleaf_ = 0;
    pk = scratch + LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_MESSAGE_HASH_SEED_BYTES;
    JavaLangSystem_arraycopyWithId_withInt_withId_withInt_withInt_(tsk, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SEED_BYTES, sm, pk, LibOrgBouncycastlePqcCryptoSphincsHorst_N_MASKS * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES);
    LibOrgBouncycastlePqcCryptoSphincsTree_treehashWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions_withByteArray_withInt_withInt_withByteArray_withLibOrgBouncycastlePqcCryptoSphincsTree_leafaddr_withByteArray_withInt_(hs, sm, pk + (LibOrgBouncycastlePqcCryptoSphincsHorst_N_MASKS * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES), LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SUBTREE_HEIGHT, tsk, b, sm, pk);
    d = [hs getMessageHash];
    [((id<LibOrgBouncycastleCryptoDigest>) nil_chk(d)) updateWithByteArray:sm withInt:scratch withInt:LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_MESSAGE_HASH_SEED_BYTES + LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_CRYPTO_PUBLICKEYBYTES];
    [d updateWithByteArray:m withInt:0 withInt:m->size_];
    [d doFinalWithByteArray:m_h withInt:0];
  }
  LibOrgBouncycastlePqcCryptoSphincsTree_leafaddr *a = new_LibOrgBouncycastlePqcCryptoSphincsTree_leafaddr_init();
  a->level_ = LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_N_LEVELS;
  a->subleaf_ = (jint) (leafidx & ((JreLShift32(1, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SUBTREE_HEIGHT)) - 1));
  a->subtree_ = JreURShift64(leafidx, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SUBTREE_HEIGHT);
  for (i = 0; i < LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_MESSAGE_HASH_SEED_BYTES; i++) {
    *IOSByteArray_GetRef(sm, i) = IOSByteArray_Get(R, i);
  }
  jint smOff = LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_MESSAGE_HASH_SEED_BYTES;
  JavaLangSystem_arraycopyWithId_withInt_withId_withInt_withInt_(tsk, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SEED_BYTES, masks, 0, LibOrgBouncycastlePqcCryptoSphincsHorst_N_MASKS * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES);
  for (i = 0; i < (LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_TOTALTREE_HEIGHT + 7) / 8; i++) {
    *IOSByteArray_GetRef(sm, smOff + i) = (jbyte) ((JreURShift64(leafidx, 8 * i)) & (jint) 0xff);
  }
  smOff += (LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_TOTALTREE_HEIGHT + 7) / 8;
  LibOrgBouncycastlePqcCryptoSphincsSeed_get_seedWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions_withByteArray_withInt_withByteArray_withLibOrgBouncycastlePqcCryptoSphincsTree_leafaddr_(hs, seed, 0, tsk, a);
  LibOrgBouncycastlePqcCryptoSphincsHorst *ht = new_LibOrgBouncycastlePqcCryptoSphincsHorst_init();
  jint horst_sigbytes = LibOrgBouncycastlePqcCryptoSphincsHorst_horst_signWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions_withByteArray_withInt_withByteArray_withByteArray_withByteArray_withByteArray_(hs, sm, smOff, root, seed, masks, m_h);
  smOff += horst_sigbytes;
  LibOrgBouncycastlePqcCryptoSphincsWots *w = new_LibOrgBouncycastlePqcCryptoSphincsWots_init();
  for (i = 0; i < LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_N_LEVELS; i++) {
    a->level_ = i;
    LibOrgBouncycastlePqcCryptoSphincsSeed_get_seedWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions_withByteArray_withInt_withByteArray_withLibOrgBouncycastlePqcCryptoSphincsTree_leafaddr_(hs, seed, 0, tsk, a);
    [w wots_signWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions:hs withByteArray:sm withInt:smOff withByteArray:root withByteArray:seed withByteArray:masks];
    smOff += LibOrgBouncycastlePqcCryptoSphincsWots_WOTS_SIGBYTES;
    LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer_compute_authpath_wotsWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions_withByteArray_withByteArray_withInt_withLibOrgBouncycastlePqcCryptoSphincsTree_leafaddr_withByteArray_withByteArray_withInt_(hs, root, sm, smOff, a, tsk, masks, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SUBTREE_HEIGHT);
    smOff += LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SUBTREE_HEIGHT * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES;
    a->subleaf_ = (jint) (a->subtree_ & ((JreLShift32(1, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SUBTREE_HEIGHT)) - 1));
    JreURShiftAssignLong(&a->subtree_, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SUBTREE_HEIGHT);
  }
  LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer_zerobytesWithByteArray_withInt_withInt_(self, tsk, 0, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_CRYPTO_SECRETKEYBYTES);
  return sm;
}

- (void)zerobytesWithByteArray:(IOSByteArray *)tsk
                       withInt:(jint)off
                       withInt:(jint)cryptoSecretkeybytes {
  LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer_zerobytesWithByteArray_withInt_withInt_(self, tsk, off, cryptoSecretkeybytes);
}

- (jboolean)verifyWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions:(LibOrgBouncycastlePqcCryptoSphincsHashFunctions *)hs
                                                        withByteArray:(IOSByteArray *)m
                                                        withByteArray:(IOSByteArray *)sm
                                                        withByteArray:(IOSByteArray *)pk {
  jint i;
  jint smlen = ((IOSByteArray *) nil_chk(sm))->size_;
  jlong leafidx = 0;
  IOSByteArray *wots_pk = [IOSByteArray newArrayWithLength:LibOrgBouncycastlePqcCryptoSphincsWots_WOTS_L * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES];
  IOSByteArray *pkhash = [IOSByteArray newArrayWithLength:LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES];
  IOSByteArray *root = [IOSByteArray newArrayWithLength:LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES];
  IOSByteArray *sig = [IOSByteArray newArrayWithLength:LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_CRYPTO_BYTES];
  jint sigp;
  IOSByteArray *tpk = [IOSByteArray newArrayWithLength:LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_CRYPTO_PUBLICKEYBYTES];
  if (smlen != LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_CRYPTO_BYTES) {
    @throw new_JavaLangIllegalArgumentException_initWithNSString_(@"signature wrong size");
  }
  IOSByteArray *m_h = [IOSByteArray newArrayWithLength:LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_MSGHASH_BYTES];
  for (i = 0; i < LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_CRYPTO_PUBLICKEYBYTES; i++) *IOSByteArray_GetRef(tpk, i) = IOSByteArray_Get(nil_chk(pk), i);
  {
    IOSByteArray *R = [IOSByteArray newArrayWithLength:LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_MESSAGE_HASH_SEED_BYTES];
    for (i = 0; i < LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_MESSAGE_HASH_SEED_BYTES; i++) *IOSByteArray_GetRef(R, i) = IOSByteArray_Get(sm, i);
    JavaLangSystem_arraycopyWithId_withInt_withId_withInt_withInt_(sm, 0, sig, 0, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_CRYPTO_BYTES);
    id<LibOrgBouncycastleCryptoDigest> mHash = [((LibOrgBouncycastlePqcCryptoSphincsHashFunctions *) nil_chk(hs)) getMessageHash];
    [((id<LibOrgBouncycastleCryptoDigest>) nil_chk(mHash)) updateWithByteArray:R withInt:0 withInt:LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_MESSAGE_HASH_SEED_BYTES];
    [mHash updateWithByteArray:tpk withInt:0 withInt:LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_CRYPTO_PUBLICKEYBYTES];
    [mHash updateWithByteArray:m withInt:0 withInt:((IOSByteArray *) nil_chk(m))->size_];
    [mHash doFinalWithByteArray:m_h withInt:0];
  }
  sigp = 0;
  sigp += LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_MESSAGE_HASH_SEED_BYTES;
  smlen -= LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_MESSAGE_HASH_SEED_BYTES;
  for (i = 0; i < (LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_TOTALTREE_HEIGHT + 7) / 8; i++) {
    leafidx ^= (JreLShift64((jlong) (IOSByteArray_Get(sig, sigp + i) & (jint) 0xff), (8 * i)));
  }
  LibOrgBouncycastlePqcCryptoSphincsHorst_horst_verifyWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions_withByteArray_withByteArray_withInt_withByteArray_withByteArray_(hs, root, sig, sigp + (LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_TOTALTREE_HEIGHT + 7) / 8, tpk, m_h);
  sigp += (LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_TOTALTREE_HEIGHT + 7) / 8;
  smlen -= (LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_TOTALTREE_HEIGHT + 7) / 8;
  sigp += LibOrgBouncycastlePqcCryptoSphincsHorst_HORST_SIGBYTES;
  smlen -= LibOrgBouncycastlePqcCryptoSphincsHorst_HORST_SIGBYTES;
  LibOrgBouncycastlePqcCryptoSphincsWots *w = new_LibOrgBouncycastlePqcCryptoSphincsWots_init();
  for (i = 0; i < LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_N_LEVELS; i++) {
    [w wots_verifyWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions:hs withByteArray:wots_pk withByteArray:sig withInt:sigp withByteArray:root withByteArray:tpk];
    sigp += LibOrgBouncycastlePqcCryptoSphincsWots_WOTS_SIGBYTES;
    smlen -= LibOrgBouncycastlePqcCryptoSphincsWots_WOTS_SIGBYTES;
    LibOrgBouncycastlePqcCryptoSphincsTree_l_treeWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions_withByteArray_withInt_withByteArray_withInt_withByteArray_withInt_(hs, pkhash, 0, wots_pk, 0, tpk, 0);
    LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer_validate_authpathWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions_withByteArray_withByteArray_withInt_withByteArray_withInt_withByteArray_withInt_(hs, root, pkhash, (jint) (leafidx & (jint) 0x1f), sig, sigp, tpk, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SUBTREE_HEIGHT);
    JreRShiftAssignLong(&leafidx, 5);
    sigp += LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SUBTREE_HEIGHT * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES;
    smlen -= LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SUBTREE_HEIGHT * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES;
  }
  jboolean verified = true;
  for (i = 0; i < LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES; i++) {
    if (IOSByteArray_Get(root, i) != IOSByteArray_Get(tpk, i + LibOrgBouncycastlePqcCryptoSphincsHorst_N_MASKS * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES)) {
      verified = false;
    }
  }
  return verified;
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 1, 2, -1, -1, -1, -1 },
    { NULL, "[B", 0x1, 3, 4, -1, -1, -1, -1 },
    { NULL, "Z", 0x1, 5, 6, -1, -1, -1, -1 },
    { NULL, "V", 0x8, 7, 8, -1, -1, -1, -1 },
    { NULL, "V", 0x8, 9, 10, -1, -1, -1, -1 },
    { NULL, "[B", 0x0, 11, 12, -1, -1, -1, -1 },
    { NULL, "V", 0x2, 13, 14, -1, -1, -1, -1 },
    { NULL, "Z", 0x0, 15, 16, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithLibOrgBouncycastleCryptoDigest:withLibOrgBouncycastleCryptoDigest:);
  methods[1].selector = @selector(init__WithBoolean:withLibOrgBouncycastleCryptoCipherParameters:);
  methods[2].selector = @selector(generateSignatureWithByteArray:);
  methods[3].selector = @selector(verifySignatureWithByteArray:withByteArray:);
  methods[4].selector = @selector(validate_authpathWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions:withByteArray:withByteArray:withInt:withByteArray:withInt:withByteArray:withInt:);
  methods[5].selector = @selector(compute_authpath_wotsWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions:withByteArray:withByteArray:withInt:withLibOrgBouncycastlePqcCryptoSphincsTree_leafaddr:withByteArray:withByteArray:withInt:);
  methods[6].selector = @selector(crypto_signWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions:withByteArray:withByteArray:);
  methods[7].selector = @selector(zerobytesWithByteArray:withInt:withInt:);
  methods[8].selector = @selector(verifyWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions:withByteArray:withByteArray:withByteArray:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "hashFunctions_", "LLibOrgBouncycastlePqcCryptoSphincsHashFunctions;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "keyData_", "[B", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LLibOrgBouncycastleCryptoDigest;LLibOrgBouncycastleCryptoDigest;", "init", "ZLLibOrgBouncycastleCryptoCipherParameters;", "generateSignature", "[B", "verifySignature", "[B[B", "validate_authpath", "LLibOrgBouncycastlePqcCryptoSphincsHashFunctions;[B[BI[BI[BI", "compute_authpath_wots", "LLibOrgBouncycastlePqcCryptoSphincsHashFunctions;[B[BILLibOrgBouncycastlePqcCryptoSphincsTree_leafaddr;[B[BI", "crypto_sign", "LLibOrgBouncycastlePqcCryptoSphincsHashFunctions;[B[B", "zerobytes", "[BII", "verify", "LLibOrgBouncycastlePqcCryptoSphincsHashFunctions;[B[B[B" };
  static const J2ObjcClassInfo _LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer = { "SPHINCS256Signer", "lib.org.bouncycastle.pqc.crypto.sphincs", ptrTable, methods, fields, 7, 0x1, 9, 2, -1, -1, -1, -1, -1 };
  return &_LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer;
}

@end

void LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer_initWithLibOrgBouncycastleCryptoDigest_withLibOrgBouncycastleCryptoDigest_(LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer *self, id<LibOrgBouncycastleCryptoDigest> nDigest, id<LibOrgBouncycastleCryptoDigest> twoNDigest) {
  NSObject_init(self);
  if ([((id<LibOrgBouncycastleCryptoDigest>) nil_chk(nDigest)) getDigestSize] != 32) {
    @throw new_JavaLangIllegalArgumentException_initWithNSString_(@"n-digest needs to produce 32 bytes of output");
  }
  if ([((id<LibOrgBouncycastleCryptoDigest>) nil_chk(twoNDigest)) getDigestSize] != 64) {
    @throw new_JavaLangIllegalArgumentException_initWithNSString_(@"2n-digest needs to produce 64 bytes of output");
  }
  self->hashFunctions_ = new_LibOrgBouncycastlePqcCryptoSphincsHashFunctions_initWithLibOrgBouncycastleCryptoDigest_withLibOrgBouncycastleCryptoDigest_(nDigest, twoNDigest);
}

LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer *new_LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer_initWithLibOrgBouncycastleCryptoDigest_withLibOrgBouncycastleCryptoDigest_(id<LibOrgBouncycastleCryptoDigest> nDigest, id<LibOrgBouncycastleCryptoDigest> twoNDigest) {
  J2OBJC_NEW_IMPL(LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer, initWithLibOrgBouncycastleCryptoDigest_withLibOrgBouncycastleCryptoDigest_, nDigest, twoNDigest)
}

LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer *create_LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer_initWithLibOrgBouncycastleCryptoDigest_withLibOrgBouncycastleCryptoDigest_(id<LibOrgBouncycastleCryptoDigest> nDigest, id<LibOrgBouncycastleCryptoDigest> twoNDigest) {
  J2OBJC_CREATE_IMPL(LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer, initWithLibOrgBouncycastleCryptoDigest_withLibOrgBouncycastleCryptoDigest_, nDigest, twoNDigest)
}

void LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer_validate_authpathWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions_withByteArray_withByteArray_withInt_withByteArray_withInt_withByteArray_withInt_(LibOrgBouncycastlePqcCryptoSphincsHashFunctions *hs, IOSByteArray *root, IOSByteArray *leaf, jint leafidx, IOSByteArray *authpath, jint auOff, IOSByteArray *masks, jint height) {
  LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer_initialize();
  jint i;
  jint j;
  IOSByteArray *buffer = [IOSByteArray newArrayWithLength:2 * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES];
  if ((leafidx & 1) != 0) {
    for (j = 0; j < LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES; j++) {
      *IOSByteArray_GetRef(buffer, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES + j) = IOSByteArray_Get(nil_chk(leaf), j);
    }
    for (j = 0; j < LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES; j++) {
      *IOSByteArray_GetRef(buffer, j) = IOSByteArray_Get(nil_chk(authpath), auOff + j);
    }
  }
  else {
    for (j = 0; j < LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES; j++) {
      *IOSByteArray_GetRef(buffer, j) = IOSByteArray_Get(nil_chk(leaf), j);
    }
    for (j = 0; j < LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES; j++) {
      *IOSByteArray_GetRef(buffer, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES + j) = IOSByteArray_Get(nil_chk(authpath), auOff + j);
    }
  }
  jint authOff = auOff + LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES;
  for (i = 0; i < height - 1; i++) {
    JreURShiftAssignInt(&leafidx, 1);
    if ((leafidx & 1) != 0) {
      [((LibOrgBouncycastlePqcCryptoSphincsHashFunctions *) nil_chk(hs)) hash_2n_n_maskWithByteArray:buffer withInt:LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES withByteArray:buffer withInt:0 withByteArray:masks withInt:2 * (LibOrgBouncycastlePqcCryptoSphincsWots_WOTS_LOG_L + i) * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES];
      for (j = 0; j < LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES; j++) {
        *IOSByteArray_GetRef(buffer, j) = IOSByteArray_Get(nil_chk(authpath), authOff + j);
      }
    }
    else {
      [((LibOrgBouncycastlePqcCryptoSphincsHashFunctions *) nil_chk(hs)) hash_2n_n_maskWithByteArray:buffer withInt:0 withByteArray:buffer withInt:0 withByteArray:masks withInt:2 * (LibOrgBouncycastlePqcCryptoSphincsWots_WOTS_LOG_L + i) * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES];
      for (j = 0; j < LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES; j++) {
        *IOSByteArray_GetRef(buffer, j + LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES) = IOSByteArray_Get(nil_chk(authpath), authOff + j);
      }
    }
    authOff += LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES;
  }
  [((LibOrgBouncycastlePqcCryptoSphincsHashFunctions *) nil_chk(hs)) hash_2n_n_maskWithByteArray:root withInt:0 withByteArray:buffer withInt:0 withByteArray:masks withInt:2 * (LibOrgBouncycastlePqcCryptoSphincsWots_WOTS_LOG_L + height - 1) * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES];
}

void LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer_compute_authpath_wotsWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions_withByteArray_withByteArray_withInt_withLibOrgBouncycastlePqcCryptoSphincsTree_leafaddr_withByteArray_withByteArray_withInt_(LibOrgBouncycastlePqcCryptoSphincsHashFunctions *hs, IOSByteArray *root, IOSByteArray *authpath, jint authOff, LibOrgBouncycastlePqcCryptoSphincsTree_leafaddr *a, IOSByteArray *sk, IOSByteArray *masks, jint height) {
  LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer_initialize();
  jint i;
  jint idx;
  jint j;
  LibOrgBouncycastlePqcCryptoSphincsTree_leafaddr *ta = new_LibOrgBouncycastlePqcCryptoSphincsTree_leafaddr_initWithLibOrgBouncycastlePqcCryptoSphincsTree_leafaddr_(a);
  IOSByteArray *tree = [IOSByteArray newArrayWithLength:2 * (JreLShift32(1, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SUBTREE_HEIGHT)) * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES];
  IOSByteArray *seed = [IOSByteArray newArrayWithLength:(JreLShift32(1, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SUBTREE_HEIGHT)) * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SEED_BYTES];
  IOSByteArray *pk = [IOSByteArray newArrayWithLength:(JreLShift32(1, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SUBTREE_HEIGHT)) * LibOrgBouncycastlePqcCryptoSphincsWots_WOTS_L * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES];
  for (ta->subleaf_ = 0; ta->subleaf_ < (JreLShift32(1, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SUBTREE_HEIGHT)); ta->subleaf_++) {
    LibOrgBouncycastlePqcCryptoSphincsSeed_get_seedWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions_withByteArray_withInt_withByteArray_withLibOrgBouncycastlePqcCryptoSphincsTree_leafaddr_(hs, seed, (jint) (ta->subleaf_ * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SEED_BYTES), sk, ta);
  }
  LibOrgBouncycastlePqcCryptoSphincsWots *w = new_LibOrgBouncycastlePqcCryptoSphincsWots_init();
  for (ta->subleaf_ = 0; ta->subleaf_ < (JreLShift32(1, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SUBTREE_HEIGHT)); ta->subleaf_++) {
    [w wots_pkgenWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions:hs withByteArray:pk withInt:(jint) (ta->subleaf_ * LibOrgBouncycastlePqcCryptoSphincsWots_WOTS_L * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES) withByteArray:seed withInt:(jint) (ta->subleaf_ * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SEED_BYTES) withByteArray:masks withInt:0];
  }
  for (ta->subleaf_ = 0; ta->subleaf_ < (JreLShift32(1, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SUBTREE_HEIGHT)); ta->subleaf_++) {
    LibOrgBouncycastlePqcCryptoSphincsTree_l_treeWithLibOrgBouncycastlePqcCryptoSphincsHashFunctions_withByteArray_withInt_withByteArray_withInt_withByteArray_withInt_(hs, tree, (jint) ((JreLShift32(1, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SUBTREE_HEIGHT)) * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES + ta->subleaf_ * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES), pk, (jint) (ta->subleaf_ * LibOrgBouncycastlePqcCryptoSphincsWots_WOTS_L * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES), masks, 0);
  }
  jint level = 0;
  for (i = (JreLShift32(1, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SUBTREE_HEIGHT)); i > 0; JreURShiftAssignInt(&i, 1)) {
    for (j = 0; j < i; j += 2) {
      [((LibOrgBouncycastlePqcCryptoSphincsHashFunctions *) nil_chk(hs)) hash_2n_n_maskWithByteArray:tree withInt:(JreURShift32(i, 1)) * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES + (JreURShift32(j, 1)) * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES withByteArray:tree withInt:i * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES + j * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES withByteArray:masks withInt:2 * (LibOrgBouncycastlePqcCryptoSphincsWots_WOTS_LOG_L + level) * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES];
    }
    level++;
  }
  idx = (jint) ((LibOrgBouncycastlePqcCryptoSphincsTree_leafaddr *) nil_chk(a))->subleaf_;
  for (i = 0; i < height; i++) {
    JavaLangSystem_arraycopyWithId_withInt_withId_withInt_withInt_(tree, (JreURShift32((JreLShift32(1, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_SUBTREE_HEIGHT)), i)) * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES + ((JreURShift32(idx, i)) ^ 1) * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES, authpath, authOff + i * LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES);
  }
  JavaLangSystem_arraycopyWithId_withInt_withId_withInt_withInt_(tree, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES, root, 0, LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Config_HASH_BYTES);
}

void LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer_zerobytesWithByteArray_withInt_withInt_(LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer *self, IOSByteArray *tsk, jint off, jint cryptoSecretkeybytes) {
  for (jint i = 0; i != cryptoSecretkeybytes; i++) {
    *IOSByteArray_GetRef(nil_chk(tsk), off + i) = 0;
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(LibOrgBouncycastlePqcCryptoSphincsSPHINCS256Signer)
