//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ../android/src/main/kotlin/lib/org/bouncycastle/crypto/engines/Grain128Engine.java
//

#include "CipherParameters.h"
#include "DataLengthException.h"
#include "Grain128Engine.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "KeyParameter.h"
#include "OutputLengthException.h"
#include "ParametersWithIV.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/IllegalStateException.h"
#include "java/lang/System.h"

@interface LibOrgBouncycastleCryptoEnginesGrain128Engine () {
 @public
  IOSByteArray *workingKey_;
  IOSByteArray *workingIV_;
  IOSByteArray *out_;
  IOSIntArray *lfsr_;
  IOSIntArray *nfsr_;
  jint output_;
  jint index_;
  jboolean initialised_;
}

- (void)initGrain OBJC_METHOD_FAMILY_NONE;

- (jint)getOutputNFSR;

- (jint)getOutputLFSR;

- (jint)getOutput;

- (IOSIntArray *)shiftWithIntArray:(IOSIntArray *)array
                           withInt:(jint)val;

- (void)setKeyWithByteArray:(IOSByteArray *)keyBytes
              withByteArray:(IOSByteArray *)ivBytes;

- (void)oneRound;

- (jbyte)getKeyStream;

@end

J2OBJC_FIELD_SETTER(LibOrgBouncycastleCryptoEnginesGrain128Engine, workingKey_, IOSByteArray *)
J2OBJC_FIELD_SETTER(LibOrgBouncycastleCryptoEnginesGrain128Engine, workingIV_, IOSByteArray *)
J2OBJC_FIELD_SETTER(LibOrgBouncycastleCryptoEnginesGrain128Engine, out_, IOSByteArray *)
J2OBJC_FIELD_SETTER(LibOrgBouncycastleCryptoEnginesGrain128Engine, lfsr_, IOSIntArray *)
J2OBJC_FIELD_SETTER(LibOrgBouncycastleCryptoEnginesGrain128Engine, nfsr_, IOSIntArray *)

inline jint LibOrgBouncycastleCryptoEnginesGrain128Engine_get_STATE_SIZE(void);
#define LibOrgBouncycastleCryptoEnginesGrain128Engine_STATE_SIZE 4
J2OBJC_STATIC_FIELD_CONSTANT(LibOrgBouncycastleCryptoEnginesGrain128Engine, STATE_SIZE, jint)

__attribute__((unused)) static void LibOrgBouncycastleCryptoEnginesGrain128Engine_initGrain(LibOrgBouncycastleCryptoEnginesGrain128Engine *self);

__attribute__((unused)) static jint LibOrgBouncycastleCryptoEnginesGrain128Engine_getOutputNFSR(LibOrgBouncycastleCryptoEnginesGrain128Engine *self);

__attribute__((unused)) static jint LibOrgBouncycastleCryptoEnginesGrain128Engine_getOutputLFSR(LibOrgBouncycastleCryptoEnginesGrain128Engine *self);

__attribute__((unused)) static jint LibOrgBouncycastleCryptoEnginesGrain128Engine_getOutput(LibOrgBouncycastleCryptoEnginesGrain128Engine *self);

__attribute__((unused)) static IOSIntArray *LibOrgBouncycastleCryptoEnginesGrain128Engine_shiftWithIntArray_withInt_(LibOrgBouncycastleCryptoEnginesGrain128Engine *self, IOSIntArray *array, jint val);

__attribute__((unused)) static void LibOrgBouncycastleCryptoEnginesGrain128Engine_setKeyWithByteArray_withByteArray_(LibOrgBouncycastleCryptoEnginesGrain128Engine *self, IOSByteArray *keyBytes, IOSByteArray *ivBytes);

__attribute__((unused)) static void LibOrgBouncycastleCryptoEnginesGrain128Engine_oneRound(LibOrgBouncycastleCryptoEnginesGrain128Engine *self);

__attribute__((unused)) static jbyte LibOrgBouncycastleCryptoEnginesGrain128Engine_getKeyStream(LibOrgBouncycastleCryptoEnginesGrain128Engine *self);

@implementation LibOrgBouncycastleCryptoEnginesGrain128Engine

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  LibOrgBouncycastleCryptoEnginesGrain128Engine_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

- (NSString *)getAlgorithmName {
  return @"Grain-128";
}

- (void)init__WithBoolean:(jboolean)forEncryption
withLibOrgBouncycastleCryptoCipherParameters:(id<LibOrgBouncycastleCryptoCipherParameters>)params {
  if (!([params isKindOfClass:[LibOrgBouncycastleCryptoParamsParametersWithIV class]])) {
    @throw new_JavaLangIllegalArgumentException_initWithNSString_(@"Grain-128 Init parameters must include an IV");
  }
  LibOrgBouncycastleCryptoParamsParametersWithIV *ivParams = (LibOrgBouncycastleCryptoParamsParametersWithIV *) cast_chk(params, [LibOrgBouncycastleCryptoParamsParametersWithIV class]);
  IOSByteArray *iv = [((LibOrgBouncycastleCryptoParamsParametersWithIV *) nil_chk(ivParams)) getIV];
  if (iv == nil || iv->size_ != 12) {
    @throw new_JavaLangIllegalArgumentException_initWithNSString_(@"Grain-128  requires exactly 12 bytes of IV");
  }
  if (!([[ivParams getParameters] isKindOfClass:[LibOrgBouncycastleCryptoParamsKeyParameter class]])) {
    @throw new_JavaLangIllegalArgumentException_initWithNSString_(@"Grain-128 Init parameters must include a key");
  }
  LibOrgBouncycastleCryptoParamsKeyParameter *key = (LibOrgBouncycastleCryptoParamsKeyParameter *) cast_chk([ivParams getParameters], [LibOrgBouncycastleCryptoParamsKeyParameter class]);
  workingIV_ = [IOSByteArray newArrayWithLength:((IOSByteArray *) nil_chk([((LibOrgBouncycastleCryptoParamsKeyParameter *) nil_chk(key)) getKey]))->size_];
  workingKey_ = [IOSByteArray newArrayWithLength:((IOSByteArray *) nil_chk([key getKey]))->size_];
  lfsr_ = [IOSIntArray newArrayWithLength:LibOrgBouncycastleCryptoEnginesGrain128Engine_STATE_SIZE];
  nfsr_ = [IOSIntArray newArrayWithLength:LibOrgBouncycastleCryptoEnginesGrain128Engine_STATE_SIZE];
  out_ = [IOSByteArray newArrayWithLength:4];
  JavaLangSystem_arraycopyWithId_withInt_withId_withInt_withInt_(iv, 0, workingIV_, 0, iv->size_);
  JavaLangSystem_arraycopyWithId_withInt_withId_withInt_withInt_([key getKey], 0, workingKey_, 0, ((IOSByteArray *) nil_chk([key getKey]))->size_);
  [self reset];
}

- (void)initGrain {
  LibOrgBouncycastleCryptoEnginesGrain128Engine_initGrain(self);
}

- (jint)getOutputNFSR {
  return LibOrgBouncycastleCryptoEnginesGrain128Engine_getOutputNFSR(self);
}

- (jint)getOutputLFSR {
  return LibOrgBouncycastleCryptoEnginesGrain128Engine_getOutputLFSR(self);
}

- (jint)getOutput {
  return LibOrgBouncycastleCryptoEnginesGrain128Engine_getOutput(self);
}

- (IOSIntArray *)shiftWithIntArray:(IOSIntArray *)array
                           withInt:(jint)val {
  return LibOrgBouncycastleCryptoEnginesGrain128Engine_shiftWithIntArray_withInt_(self, array, val);
}

- (void)setKeyWithByteArray:(IOSByteArray *)keyBytes
              withByteArray:(IOSByteArray *)ivBytes {
  LibOrgBouncycastleCryptoEnginesGrain128Engine_setKeyWithByteArray_withByteArray_(self, keyBytes, ivBytes);
}

- (jint)processBytesWithByteArray:(IOSByteArray *)inArg
                          withInt:(jint)inOff
                          withInt:(jint)len
                    withByteArray:(IOSByteArray *)outArg
                          withInt:(jint)outOff {
  if (!initialised_) {
    @throw new_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$$", [self getAlgorithmName], @" not initialised"));
  }
  if ((inOff + len) > ((IOSByteArray *) nil_chk(inArg))->size_) {
    @throw new_LibOrgBouncycastleCryptoDataLengthException_initWithNSString_(@"input buffer too short");
  }
  if ((outOff + len) > ((IOSByteArray *) nil_chk(outArg))->size_) {
    @throw new_LibOrgBouncycastleCryptoOutputLengthException_initWithNSString_(@"output buffer too short");
  }
  for (jint i = 0; i < len; i++) {
    *IOSByteArray_GetRef(outArg, outOff + i) = (jbyte) (IOSByteArray_Get(inArg, inOff + i) ^ LibOrgBouncycastleCryptoEnginesGrain128Engine_getKeyStream(self));
  }
  return len;
}

- (void)reset {
  index_ = 4;
  LibOrgBouncycastleCryptoEnginesGrain128Engine_setKeyWithByteArray_withByteArray_(self, workingKey_, workingIV_);
  LibOrgBouncycastleCryptoEnginesGrain128Engine_initGrain(self);
}

- (void)oneRound {
  LibOrgBouncycastleCryptoEnginesGrain128Engine_oneRound(self);
}

- (jbyte)returnByteWithByte:(jbyte)inArg {
  if (!initialised_) {
    @throw new_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$$", [self getAlgorithmName], @" not initialised"));
  }
  return (jbyte) (inArg ^ LibOrgBouncycastleCryptoEnginesGrain128Engine_getKeyStream(self));
}

- (jbyte)getKeyStream {
  return LibOrgBouncycastleCryptoEnginesGrain128Engine_getKeyStream(self);
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LNSString;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 0, 1, 2, -1, -1, -1 },
    { NULL, "V", 0x2, -1, -1, -1, -1, -1, -1 },
    { NULL, "I", 0x2, -1, -1, -1, -1, -1, -1 },
    { NULL, "I", 0x2, -1, -1, -1, -1, -1, -1 },
    { NULL, "I", 0x2, -1, -1, -1, -1, -1, -1 },
    { NULL, "[I", 0x2, 3, 4, -1, -1, -1, -1 },
    { NULL, "V", 0x2, 5, 6, -1, -1, -1, -1 },
    { NULL, "I", 0x1, 7, 8, 9, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x2, -1, -1, -1, -1, -1, -1 },
    { NULL, "B", 0x1, 10, 11, -1, -1, -1, -1 },
    { NULL, "B", 0x2, -1, -1, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(init);
  methods[1].selector = @selector(getAlgorithmName);
  methods[2].selector = @selector(init__WithBoolean:withLibOrgBouncycastleCryptoCipherParameters:);
  methods[3].selector = @selector(initGrain);
  methods[4].selector = @selector(getOutputNFSR);
  methods[5].selector = @selector(getOutputLFSR);
  methods[6].selector = @selector(getOutput);
  methods[7].selector = @selector(shiftWithIntArray:withInt:);
  methods[8].selector = @selector(setKeyWithByteArray:withByteArray:);
  methods[9].selector = @selector(processBytesWithByteArray:withInt:withInt:withByteArray:withInt:);
  methods[10].selector = @selector(reset);
  methods[11].selector = @selector(oneRound);
  methods[12].selector = @selector(returnByteWithByte:);
  methods[13].selector = @selector(getKeyStream);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "STATE_SIZE", "I", .constantValue.asInt = LibOrgBouncycastleCryptoEnginesGrain128Engine_STATE_SIZE, 0x1a, -1, -1, -1, -1 },
    { "workingKey_", "[B", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "workingIV_", "[B", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "out_", "[B", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "lfsr_", "[I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "nfsr_", "[I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "output_", "I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "index_", "I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "initialised_", "Z", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "init", "ZLLibOrgBouncycastleCryptoCipherParameters;", "LJavaLangIllegalArgumentException;", "shift", "[II", "setKey", "[B[B", "processBytes", "[BII[BI", "LLibOrgBouncycastleCryptoDataLengthException;", "returnByte", "B" };
  static const J2ObjcClassInfo _LibOrgBouncycastleCryptoEnginesGrain128Engine = { "Grain128Engine", "lib.org.bouncycastle.crypto.engines", ptrTable, methods, fields, 7, 0x1, 14, 9, -1, -1, -1, -1, -1 };
  return &_LibOrgBouncycastleCryptoEnginesGrain128Engine;
}

@end

void LibOrgBouncycastleCryptoEnginesGrain128Engine_init(LibOrgBouncycastleCryptoEnginesGrain128Engine *self) {
  NSObject_init(self);
  self->index_ = 4;
  self->initialised_ = false;
}

LibOrgBouncycastleCryptoEnginesGrain128Engine *new_LibOrgBouncycastleCryptoEnginesGrain128Engine_init() {
  J2OBJC_NEW_IMPL(LibOrgBouncycastleCryptoEnginesGrain128Engine, init)
}

LibOrgBouncycastleCryptoEnginesGrain128Engine *create_LibOrgBouncycastleCryptoEnginesGrain128Engine_init() {
  J2OBJC_CREATE_IMPL(LibOrgBouncycastleCryptoEnginesGrain128Engine, init)
}

void LibOrgBouncycastleCryptoEnginesGrain128Engine_initGrain(LibOrgBouncycastleCryptoEnginesGrain128Engine *self) {
  for (jint i = 0; i < 8; i++) {
    self->output_ = LibOrgBouncycastleCryptoEnginesGrain128Engine_getOutput(self);
    self->nfsr_ = LibOrgBouncycastleCryptoEnginesGrain128Engine_shiftWithIntArray_withInt_(self, self->nfsr_, LibOrgBouncycastleCryptoEnginesGrain128Engine_getOutputNFSR(self) ^ IOSIntArray_Get(nil_chk(self->lfsr_), 0) ^ self->output_);
    self->lfsr_ = LibOrgBouncycastleCryptoEnginesGrain128Engine_shiftWithIntArray_withInt_(self, self->lfsr_, LibOrgBouncycastleCryptoEnginesGrain128Engine_getOutputLFSR(self) ^ self->output_);
  }
  self->initialised_ = true;
}

jint LibOrgBouncycastleCryptoEnginesGrain128Engine_getOutputNFSR(LibOrgBouncycastleCryptoEnginesGrain128Engine *self) {
  jint b0 = IOSIntArray_Get(nil_chk(self->nfsr_), 0);
  jint b3 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 0), 3)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 1), 29));
  jint b11 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 0), 11)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 1), 21));
  jint b13 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 0), 13)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 1), 19));
  jint b17 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 0), 17)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 1), 15));
  jint b18 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 0), 18)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 1), 14));
  jint b26 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 0), 26)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 1), 6));
  jint b27 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 0), 27)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 1), 5));
  jint b40 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 1), 8)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 2), 24));
  jint b48 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 1), 16)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 2), 16));
  jint b56 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 1), 24)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 2), 8));
  jint b59 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 1), 27)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 2), 5));
  jint b61 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 1), 29)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 2), 3));
  jint b65 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 2), 1)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 3), 31));
  jint b67 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 2), 3)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 3), 29));
  jint b68 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 2), 4)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 3), 28));
  jint b84 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 2), 20)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 3), 12));
  jint b91 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 2), 27)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 3), 5));
  jint b96 = IOSIntArray_Get(self->nfsr_, 3);
  return b0 ^ b26 ^ b56 ^ b91 ^ b96 ^ b3 & b67 ^ b11 & b13 ^ b17 & b18 ^ b27 & b59 ^ b40 & b48 ^ b61 & b65 ^ b68 & b84;
}

jint LibOrgBouncycastleCryptoEnginesGrain128Engine_getOutputLFSR(LibOrgBouncycastleCryptoEnginesGrain128Engine *self) {
  jint s0 = IOSIntArray_Get(nil_chk(self->lfsr_), 0);
  jint s7 = (JreURShift32(IOSIntArray_Get(self->lfsr_, 0), 7)) | (JreLShift32(IOSIntArray_Get(self->lfsr_, 1), 25));
  jint s38 = (JreURShift32(IOSIntArray_Get(self->lfsr_, 1), 6)) | (JreLShift32(IOSIntArray_Get(self->lfsr_, 2), 26));
  jint s70 = (JreURShift32(IOSIntArray_Get(self->lfsr_, 2), 6)) | (JreLShift32(IOSIntArray_Get(self->lfsr_, 3), 26));
  jint s81 = (JreURShift32(IOSIntArray_Get(self->lfsr_, 2), 17)) | (JreLShift32(IOSIntArray_Get(self->lfsr_, 3), 15));
  jint s96 = IOSIntArray_Get(self->lfsr_, 3);
  return s0 ^ s7 ^ s38 ^ s70 ^ s81 ^ s96;
}

jint LibOrgBouncycastleCryptoEnginesGrain128Engine_getOutput(LibOrgBouncycastleCryptoEnginesGrain128Engine *self) {
  jint b2 = (JreURShift32(IOSIntArray_Get(nil_chk(self->nfsr_), 0), 2)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 1), 30));
  jint b12 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 0), 12)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 1), 20));
  jint b15 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 0), 15)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 1), 17));
  jint b36 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 1), 4)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 2), 28));
  jint b45 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 1), 13)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 2), 19));
  jint b64 = IOSIntArray_Get(self->nfsr_, 2);
  jint b73 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 2), 9)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 3), 23));
  jint b89 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 2), 25)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 3), 7));
  jint b95 = (JreURShift32(IOSIntArray_Get(self->nfsr_, 2), 31)) | (JreLShift32(IOSIntArray_Get(self->nfsr_, 3), 1));
  jint s8 = (JreURShift32(IOSIntArray_Get(nil_chk(self->lfsr_), 0), 8)) | (JreLShift32(IOSIntArray_Get(self->lfsr_, 1), 24));
  jint s13 = (JreURShift32(IOSIntArray_Get(self->lfsr_, 0), 13)) | (JreLShift32(IOSIntArray_Get(self->lfsr_, 1), 19));
  jint s20 = (JreURShift32(IOSIntArray_Get(self->lfsr_, 0), 20)) | (JreLShift32(IOSIntArray_Get(self->lfsr_, 1), 12));
  jint s42 = (JreURShift32(IOSIntArray_Get(self->lfsr_, 1), 10)) | (JreLShift32(IOSIntArray_Get(self->lfsr_, 2), 22));
  jint s60 = (JreURShift32(IOSIntArray_Get(self->lfsr_, 1), 28)) | (JreLShift32(IOSIntArray_Get(self->lfsr_, 2), 4));
  jint s79 = (JreURShift32(IOSIntArray_Get(self->lfsr_, 2), 15)) | (JreLShift32(IOSIntArray_Get(self->lfsr_, 3), 17));
  jint s93 = (JreURShift32(IOSIntArray_Get(self->lfsr_, 2), 29)) | (JreLShift32(IOSIntArray_Get(self->lfsr_, 3), 3));
  jint s95 = (JreURShift32(IOSIntArray_Get(self->lfsr_, 2), 31)) | (JreLShift32(IOSIntArray_Get(self->lfsr_, 3), 1));
  return b12 & s8 ^ s13 & s20 ^ b95 & s42 ^ s60 & s79 ^ b12 & b95 & s95 ^ s93 ^ b2 ^ b15 ^ b36 ^ b45 ^ b64 ^ b73 ^ b89;
}

IOSIntArray *LibOrgBouncycastleCryptoEnginesGrain128Engine_shiftWithIntArray_withInt_(LibOrgBouncycastleCryptoEnginesGrain128Engine *self, IOSIntArray *array, jint val) {
  *IOSIntArray_GetRef(nil_chk(array), 0) = IOSIntArray_Get(array, 1);
  *IOSIntArray_GetRef(array, 1) = IOSIntArray_Get(array, 2);
  *IOSIntArray_GetRef(array, 2) = IOSIntArray_Get(array, 3);
  *IOSIntArray_GetRef(array, 3) = val;
  return array;
}

void LibOrgBouncycastleCryptoEnginesGrain128Engine_setKeyWithByteArray_withByteArray_(LibOrgBouncycastleCryptoEnginesGrain128Engine *self, IOSByteArray *keyBytes, IOSByteArray *ivBytes) {
  *IOSByteArray_GetRef(nil_chk(ivBytes), 12) = (jbyte) (jint) 0xFF;
  *IOSByteArray_GetRef(ivBytes, 13) = (jbyte) (jint) 0xFF;
  *IOSByteArray_GetRef(ivBytes, 14) = (jbyte) (jint) 0xFF;
  *IOSByteArray_GetRef(ivBytes, 15) = (jbyte) (jint) 0xFF;
  self->workingKey_ = keyBytes;
  self->workingIV_ = ivBytes;
  jint j = 0;
  for (jint i = 0; i < ((IOSIntArray *) nil_chk(self->nfsr_))->size_; i++) {
    *IOSIntArray_GetRef(self->nfsr_, i) = (JreLShift32((IOSByteArray_Get(nil_chk(self->workingKey_), j + 3)), 24)) | ((JreLShift32((IOSByteArray_Get(self->workingKey_, j + 2)), 16)) & (jint) 0x00FF0000) | ((JreLShift32((IOSByteArray_Get(self->workingKey_, j + 1)), 8)) & (jint) 0x0000FF00) | ((IOSByteArray_Get(self->workingKey_, j)) & (jint) 0x000000FF);
    *IOSIntArray_GetRef(nil_chk(self->lfsr_), i) = (JreLShift32((IOSByteArray_Get(self->workingIV_, j + 3)), 24)) | ((JreLShift32((IOSByteArray_Get(self->workingIV_, j + 2)), 16)) & (jint) 0x00FF0000) | ((JreLShift32((IOSByteArray_Get(self->workingIV_, j + 1)), 8)) & (jint) 0x0000FF00) | ((IOSByteArray_Get(self->workingIV_, j)) & (jint) 0x000000FF);
    j += 4;
  }
}

void LibOrgBouncycastleCryptoEnginesGrain128Engine_oneRound(LibOrgBouncycastleCryptoEnginesGrain128Engine *self) {
  self->output_ = LibOrgBouncycastleCryptoEnginesGrain128Engine_getOutput(self);
  *IOSByteArray_GetRef(nil_chk(self->out_), 0) = (jbyte) self->output_;
  *IOSByteArray_GetRef(self->out_, 1) = (jbyte) (JreRShift32(self->output_, 8));
  *IOSByteArray_GetRef(self->out_, 2) = (jbyte) (JreRShift32(self->output_, 16));
  *IOSByteArray_GetRef(self->out_, 3) = (jbyte) (JreRShift32(self->output_, 24));
  self->nfsr_ = LibOrgBouncycastleCryptoEnginesGrain128Engine_shiftWithIntArray_withInt_(self, self->nfsr_, LibOrgBouncycastleCryptoEnginesGrain128Engine_getOutputNFSR(self) ^ IOSIntArray_Get(nil_chk(self->lfsr_), 0));
  self->lfsr_ = LibOrgBouncycastleCryptoEnginesGrain128Engine_shiftWithIntArray_withInt_(self, self->lfsr_, LibOrgBouncycastleCryptoEnginesGrain128Engine_getOutputLFSR(self));
}

jbyte LibOrgBouncycastleCryptoEnginesGrain128Engine_getKeyStream(LibOrgBouncycastleCryptoEnginesGrain128Engine *self) {
  if (self->index_ > 3) {
    LibOrgBouncycastleCryptoEnginesGrain128Engine_oneRound(self);
    self->index_ = 0;
  }
  return IOSByteArray_Get(nil_chk(self->out_), self->index_++);
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(LibOrgBouncycastleCryptoEnginesGrain128Engine)
