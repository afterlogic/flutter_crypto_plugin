//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ../android/src/main/kotlin/lib/org/bouncycastle/jce/provider/JcePKIXCRLUtil.java
//

#include "AnnotatedException.h"
#include "IOSClass.h"
#include "J2ObjC_source.h"
#include "JcePKIXCRLUtil.h"
#include "PKIXCRLStoreSelector.h"
#include "Store.h"
#include "StoreException.h"
#include "java/security/cert/CertStore.h"
#include "java/security/cert/CertStoreException.h"
#include "java/security/cert/X509CRL.h"
#include "java/security/cert/X509Certificate.h"
#include "java/util/Collection.h"
#include "java/util/Date.h"
#include "java/util/HashSet.h"
#include "java/util/Iterator.h"
#include "java/util/List.h"
#include "java/util/Set.h"

@interface LibOrgBouncycastleJceProviderJcePKIXCRLUtil ()

- (id<JavaUtilCollection>)findCRLsWithLibOrgBouncycastleJcajcePKIXCRLStoreSelector:(LibOrgBouncycastleJcajcePKIXCRLStoreSelector *)crlSelect
                                                                  withJavaUtilList:(id<JavaUtilList>)crlStores;

@end

__attribute__((unused)) static id<JavaUtilCollection> LibOrgBouncycastleJceProviderJcePKIXCRLUtil_findCRLsWithLibOrgBouncycastleJcajcePKIXCRLStoreSelector_withJavaUtilList_(LibOrgBouncycastleJceProviderJcePKIXCRLUtil *self, LibOrgBouncycastleJcajcePKIXCRLStoreSelector *crlSelect, id<JavaUtilList> crlStores);

@implementation LibOrgBouncycastleJceProviderJcePKIXCRLUtil

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  LibOrgBouncycastleJceProviderJcePKIXCRLUtil_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

- (id<JavaUtilSet>)findCRLsWithLibOrgBouncycastleJcajcePKIXCRLStoreSelector:(LibOrgBouncycastleJcajcePKIXCRLStoreSelector *)crlselect
                                                           withJavaUtilDate:(JavaUtilDate *)validityDate
                                                           withJavaUtilList:(id<JavaUtilList>)certStores
                                                           withJavaUtilList:(id<JavaUtilList>)pkixCrlStores {
  id<JavaUtilSet> initialSet = new_JavaUtilHashSet_init();
  @try {
    [initialSet addAllWithJavaUtilCollection:LibOrgBouncycastleJceProviderJcePKIXCRLUtil_findCRLsWithLibOrgBouncycastleJcajcePKIXCRLStoreSelector_withJavaUtilList_(self, crlselect, pkixCrlStores)];
    [initialSet addAllWithJavaUtilCollection:LibOrgBouncycastleJceProviderJcePKIXCRLUtil_findCRLsWithLibOrgBouncycastleJcajcePKIXCRLStoreSelector_withJavaUtilList_(self, crlselect, certStores)];
  }
  @catch (LibOrgBouncycastleJceProviderAnnotatedException *e) {
    @throw new_LibOrgBouncycastleJceProviderAnnotatedException_initWithNSString_withJavaLangThrowable_(@"Exception obtaining complete CRLs.", e);
  }
  id<JavaUtilSet> finalSet = new_JavaUtilHashSet_init();
  for (id<JavaUtilIterator> it = [initialSet iterator]; [((id<JavaUtilIterator>) nil_chk(it)) hasNext]; ) {
    JavaSecurityCertX509CRL *crl = (JavaSecurityCertX509CRL *) cast_chk([it next], [JavaSecurityCertX509CRL class]);
    if ([((JavaUtilDate *) nil_chk([((JavaSecurityCertX509CRL *) nil_chk(crl)) getNextUpdate])) afterWithJavaUtilDate:validityDate]) {
      JavaSecurityCertX509Certificate *cert = [((LibOrgBouncycastleJcajcePKIXCRLStoreSelector *) nil_chk(crlselect)) getCertificateChecking];
      if (cert != nil) {
        if ([((JavaUtilDate *) nil_chk([crl getThisUpdate])) beforeWithJavaUtilDate:[cert getNotAfter]]) {
          [finalSet addWithId:crl];
        }
      }
      else {
        [finalSet addWithId:crl];
      }
    }
  }
  return finalSet;
}

- (id<JavaUtilCollection>)findCRLsWithLibOrgBouncycastleJcajcePKIXCRLStoreSelector:(LibOrgBouncycastleJcajcePKIXCRLStoreSelector *)crlSelect
                                                                  withJavaUtilList:(id<JavaUtilList>)crlStores {
  return LibOrgBouncycastleJceProviderJcePKIXCRLUtil_findCRLsWithLibOrgBouncycastleJcajcePKIXCRLStoreSelector_withJavaUtilList_(self, crlSelect, crlStores);
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x0, -1, -1, -1, -1, -1, -1 },
    { NULL, "LJavaUtilSet;", 0x1, 0, 1, 2, -1, -1, -1 },
    { NULL, "LJavaUtilCollection;", 0x12, 0, 3, 2, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(init);
  methods[1].selector = @selector(findCRLsWithLibOrgBouncycastleJcajcePKIXCRLStoreSelector:withJavaUtilDate:withJavaUtilList:withJavaUtilList:);
  methods[2].selector = @selector(findCRLsWithLibOrgBouncycastleJcajcePKIXCRLStoreSelector:withJavaUtilList:);
  #pragma clang diagnostic pop
  static const void *ptrTable[] = { "findCRLs", "LLibOrgBouncycastleJcajcePKIXCRLStoreSelector;LJavaUtilDate;LJavaUtilList;LJavaUtilList;", "LLibOrgBouncycastleJceProviderAnnotatedException;", "LLibOrgBouncycastleJcajcePKIXCRLStoreSelector;LJavaUtilList;" };
  static const J2ObjcClassInfo _LibOrgBouncycastleJceProviderJcePKIXCRLUtil = { "JcePKIXCRLUtil", "lib.org.bouncycastle.jce.provider", ptrTable, methods, NULL, 7, 0x0, 3, 0, -1, -1, -1, -1, -1 };
  return &_LibOrgBouncycastleJceProviderJcePKIXCRLUtil;
}

@end

void LibOrgBouncycastleJceProviderJcePKIXCRLUtil_init(LibOrgBouncycastleJceProviderJcePKIXCRLUtil *self) {
  NSObject_init(self);
}

LibOrgBouncycastleJceProviderJcePKIXCRLUtil *new_LibOrgBouncycastleJceProviderJcePKIXCRLUtil_init() {
  J2OBJC_NEW_IMPL(LibOrgBouncycastleJceProviderJcePKIXCRLUtil, init)
}

LibOrgBouncycastleJceProviderJcePKIXCRLUtil *create_LibOrgBouncycastleJceProviderJcePKIXCRLUtil_init() {
  J2OBJC_CREATE_IMPL(LibOrgBouncycastleJceProviderJcePKIXCRLUtil, init)
}

id<JavaUtilCollection> LibOrgBouncycastleJceProviderJcePKIXCRLUtil_findCRLsWithLibOrgBouncycastleJcajcePKIXCRLStoreSelector_withJavaUtilList_(LibOrgBouncycastleJceProviderJcePKIXCRLUtil *self, LibOrgBouncycastleJcajcePKIXCRLStoreSelector *crlSelect, id<JavaUtilList> crlStores) {
  id<JavaUtilSet> crls = new_JavaUtilHashSet_init();
  id<JavaUtilIterator> iter = [((id<JavaUtilList>) nil_chk(crlStores)) iterator];
  LibOrgBouncycastleJceProviderAnnotatedException *lastException = nil;
  jboolean foundValidStore = false;
  while ([((id<JavaUtilIterator>) nil_chk(iter)) hasNext]) {
    id obj = [iter next];
    if ([LibOrgBouncycastleUtilStore_class_() isInstance:obj]) {
      id<LibOrgBouncycastleUtilStore> store = (id<LibOrgBouncycastleUtilStore>) cast_check(obj, LibOrgBouncycastleUtilStore_class_());
      @try {
        [crls addAllWithJavaUtilCollection:[((id<LibOrgBouncycastleUtilStore>) nil_chk(store)) getMatchesWithLibOrgBouncycastleUtilSelector:crlSelect]];
        foundValidStore = true;
      }
      @catch (LibOrgBouncycastleUtilStoreException *e) {
        lastException = new_LibOrgBouncycastleJceProviderAnnotatedException_initWithNSString_withJavaLangThrowable_(@"Exception searching in X.509 CRL store.", e);
      }
    }
    else {
      JavaSecurityCertCertStore *store = (JavaSecurityCertCertStore *) cast_chk(obj, [JavaSecurityCertCertStore class]);
      @try {
        [crls addAllWithJavaUtilCollection:LibOrgBouncycastleJcajcePKIXCRLStoreSelector_getCRLsWithLibOrgBouncycastleJcajcePKIXCRLStoreSelector_withJavaSecurityCertCertStore_(crlSelect, store)];
        foundValidStore = true;
      }
      @catch (JavaSecurityCertCertStoreException *e) {
        lastException = new_LibOrgBouncycastleJceProviderAnnotatedException_initWithNSString_withJavaLangThrowable_(@"Exception searching in X.509 CRL store.", e);
      }
    }
  }
  if (!foundValidStore && lastException != nil) {
    @throw lastException;
  }
  return crls;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(LibOrgBouncycastleJceProviderJcePKIXCRLUtil)
