//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ../android/src/main/kotlin/lib/org/bouncycastle/crypto/tls/DTLSReplayWindow.java
//

#include "DTLSReplayWindow.h"
#include "J2ObjC_source.h"
#include "java/lang/IllegalArgumentException.h"

@interface LibOrgBouncycastleCryptoTlsDTLSReplayWindow () {
 @public
  jlong latestConfirmedSeq_;
  jlong bitmap_;
}

@end

inline jlong LibOrgBouncycastleCryptoTlsDTLSReplayWindow_get_VALID_SEQ_MASK(void);
#define LibOrgBouncycastleCryptoTlsDTLSReplayWindow_VALID_SEQ_MASK 281474976710655LL
J2OBJC_STATIC_FIELD_CONSTANT(LibOrgBouncycastleCryptoTlsDTLSReplayWindow, VALID_SEQ_MASK, jlong)

inline jlong LibOrgBouncycastleCryptoTlsDTLSReplayWindow_get_WINDOW_SIZE(void);
#define LibOrgBouncycastleCryptoTlsDTLSReplayWindow_WINDOW_SIZE 64LL
J2OBJC_STATIC_FIELD_CONSTANT(LibOrgBouncycastleCryptoTlsDTLSReplayWindow, WINDOW_SIZE, jlong)

@implementation LibOrgBouncycastleCryptoTlsDTLSReplayWindow

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  LibOrgBouncycastleCryptoTlsDTLSReplayWindow_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

- (jboolean)shouldDiscardWithLong:(jlong)seq {
  if ((seq & LibOrgBouncycastleCryptoTlsDTLSReplayWindow_VALID_SEQ_MASK) != seq) {
    return true;
  }
  if (seq <= latestConfirmedSeq_) {
    jlong diff = latestConfirmedSeq_ - seq;
    if (diff >= LibOrgBouncycastleCryptoTlsDTLSReplayWindow_WINDOW_SIZE) {
      return true;
    }
    if ((bitmap_ & (JreLShift64(1LL, diff))) != 0) {
      return true;
    }
  }
  return false;
}

- (void)reportAuthenticatedWithLong:(jlong)seq {
  if ((seq & LibOrgBouncycastleCryptoTlsDTLSReplayWindow_VALID_SEQ_MASK) != seq) {
    @throw new_JavaLangIllegalArgumentException_initWithNSString_(@"'seq' out of range");
  }
  if (seq <= latestConfirmedSeq_) {
    jlong diff = latestConfirmedSeq_ - seq;
    if (diff < LibOrgBouncycastleCryptoTlsDTLSReplayWindow_WINDOW_SIZE) {
      bitmap_ |= (JreLShift64(1LL, diff));
    }
  }
  else {
    jlong diff = seq - latestConfirmedSeq_;
    if (diff >= LibOrgBouncycastleCryptoTlsDTLSReplayWindow_WINDOW_SIZE) {
      bitmap_ = 1;
    }
    else {
      JreLShiftAssignLong(&bitmap_, (jint) diff);
      bitmap_ |= 1;
    }
    latestConfirmedSeq_ = seq;
  }
}

- (void)reset {
  latestConfirmedSeq_ = -1;
  bitmap_ = 0;
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x0, -1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x0, 0, 1, -1, -1, -1, -1 },
    { NULL, "V", 0x0, 2, 1, -1, -1, -1, -1 },
    { NULL, "V", 0x0, -1, -1, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(init);
  methods[1].selector = @selector(shouldDiscardWithLong:);
  methods[2].selector = @selector(reportAuthenticatedWithLong:);
  methods[3].selector = @selector(reset);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "VALID_SEQ_MASK", "J", .constantValue.asLong = LibOrgBouncycastleCryptoTlsDTLSReplayWindow_VALID_SEQ_MASK, 0x1a, -1, -1, -1, -1 },
    { "WINDOW_SIZE", "J", .constantValue.asLong = LibOrgBouncycastleCryptoTlsDTLSReplayWindow_WINDOW_SIZE, 0x1a, -1, -1, -1, -1 },
    { "latestConfirmedSeq_", "J", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "bitmap_", "J", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "shouldDiscard", "J", "reportAuthenticated" };
  static const J2ObjcClassInfo _LibOrgBouncycastleCryptoTlsDTLSReplayWindow = { "DTLSReplayWindow", "lib.org.bouncycastle.crypto.tls", ptrTable, methods, fields, 7, 0x0, 4, 4, -1, -1, -1, -1, -1 };
  return &_LibOrgBouncycastleCryptoTlsDTLSReplayWindow;
}

@end

void LibOrgBouncycastleCryptoTlsDTLSReplayWindow_init(LibOrgBouncycastleCryptoTlsDTLSReplayWindow *self) {
  NSObject_init(self);
  self->latestConfirmedSeq_ = -1;
  self->bitmap_ = 0;
}

LibOrgBouncycastleCryptoTlsDTLSReplayWindow *new_LibOrgBouncycastleCryptoTlsDTLSReplayWindow_init() {
  J2OBJC_NEW_IMPL(LibOrgBouncycastleCryptoTlsDTLSReplayWindow, init)
}

LibOrgBouncycastleCryptoTlsDTLSReplayWindow *create_LibOrgBouncycastleCryptoTlsDTLSReplayWindow_init() {
  J2OBJC_CREATE_IMPL(LibOrgBouncycastleCryptoTlsDTLSReplayWindow, init)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(LibOrgBouncycastleCryptoTlsDTLSReplayWindow)
